<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cocoawork.appstore.mapper.UserMapper">

    <resultMap id="BaseResultMap" type="com.cocoawork.appstore.entity.User">
        <result column="uid" property="uid" jdbcType="VARCHAR"/>
        <result column="user_name" property="userName" jdbcType="VARCHAR"/>
        <result column="password" property="password" jdbcType="VARCHAR"/>
        <result column="phone_num" property="phoneNum" jdbcType="VARCHAR"/>
        <result column="gender" property="gender" jdbcType="INTEGER"/>
        <result column="age" property="age" jdbcType="INTEGER"/>
    </resultMap>


    <insert id="addUser" parameterType="com.cocoawork.appstore.entity.User">
        <selectKey keyProperty="uid" resultType="String" order="BEFORE">
            select replace(uuid(),'-','') from dual
        </selectKey>
        INSERT INTO `user` (uid, user_name, password, phone_num, gender, age
        <if test="roles!=null and roles.size()>0">,roles</if>
        )
        VALUES (#{uid}, #{userName}, #{password}, #{phoneNum}, #{gender}, #{age}
        <if test="roles!=null and roles.size()>0">
            <foreach collection="roles" open="," close="" separator="','" item="role">&apos;${role.id}&apos;</foreach>
        </if>
        )
    </insert>


    <select id="getUser" resultMap="BaseResultMap">
        SELECT * FROM `user` WHERE 1=1
        <if test="userName!=null">AND user_name = #{userName}</if>
        <if test="password!=null">AND password = #{password}</if>
    </select>

    <select id="getUserById" resultMap="BaseResultMap">
        SELECT * FROM `user` WHERE uid=#{uid}
    </select>


</mapper>